# values.yaml with envFrom injection pattern
# Used in apps/{env}/{app}/values.yaml or infra/{env}/services/{component}/values.yaml

replicaCount: 1

image:
  repository: registry.example.com/myapp
  pullPolicy: IfNotPresent
  tag: latest  # Overridden by patches.yaml with image automation marker

# CRITICAL: envFrom injection for configs and secrets
envFrom:
  - configMapRef:
      name: myapp-config        # Plain ConfigMap from configs/
  - secretRef:
      name: myapp               # Secret from ExternalSecret in secrets/

# Optional: individual env vars that override or supplement envFrom
env:
  - name: ENVIRONMENT
    value: "dev"
  - name: POD_NAME
    valueFrom:
      fieldRef:
        fieldPath: metadata.name

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    memory: 256Mi

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt
  hosts:
    - host: myapp.dev.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: myapp-tls
      hosts:
        - myapp.dev.example.com

livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
