# Example: ExternalSecret for application
# File: apps/dev/my-app/secrets/my-app.external.yaml

apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: my-app-dev
  namespace: dev
spec:
  # Refresh interval for secret sync
  refreshInterval: 1h

  # Reference to ClusterSecretStore
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secrets-manager

  # Target Kubernetes secret
  target:
    name: my-app-dev
    creationPolicy: Owner
    deletionPolicy: Retain

  # Extract all keys from secret path
  dataFrom:
    - extract:
        key: myorg/dev/my-app  # AWS Secrets Manager path

---
# Alternative: Map specific keys
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: my-app-dev-mapped
  namespace: dev
spec:
  refreshInterval: 1h

  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-secrets-manager

  target:
    name: my-app-dev-mapped
    creationPolicy: Owner

  # Map specific keys with renaming
  data:
    - secretKey: DATABASE_URL       # Key in K8s secret
      remoteRef:
        key: myorg/dev/my-app       # Secret path
        property: database_url      # Key in remote secret

    - secretKey: API_KEY
      remoteRef:
        key: myorg/dev/my-app
        property: api_key

---
# Usage in values.yaml:
# envFrom:
#   - secretRef:
#       name: my-app-dev
#
# Or for specific keys:
# env:
#   - name: DATABASE_URL
#     valueFrom:
#       secretKeyRef:
#         name: my-app-dev
#         key: database_url
